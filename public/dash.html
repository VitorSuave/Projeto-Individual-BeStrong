<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard | BeStrong</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="./css/dashboard.css">
    <link rel="icon" href="./assets/FlavIcon.png" type="image/png" sizes="32x32">
</head>
<body>

    <div class="janela">
        <div class="header-left">
            <h1>PAINEL</h1>

            <div class="hello">
                <h3>Bem-vindo(a), <span id="b_usuario">usuário</span>!</h3>
            </div>


            <div class="btn btn-dark">
                <a href="painel.html">
                    <h3>Quiz</h3>
                </a>
            </div>


            <div class="btn btn-dark" onclick="limparSessao()">
                <h3>Sair</h3>
            </div>

        </div>
    <div>

        <!-- <h3>KPIs</h3>
        <div>
            <span>Média de Acertos: <span id="media-acertos">--</span></span>
            <span>Maior Pontuação: <span id="maior-pontuacao">--</span></span>
            <span>Total de Quizzes: <span id="total-quizzes">--</span></span>
        </div>
    </div> -->

    <canvas id="graficoAcertos"></canvas>
    <canvas id="graficoPontuacao"></canvas>

    
</body>
</html>

<script>
    // Busca os dados da API
    fetch('/dashboard/dados')
        .then(response => response.json())
        .then(data => {
            // Cálculo dos KPIs
            const mediaAcertos = data.acertosUsuario.reduce((sum, item) => sum + item.total_acertos, 0) / data.acertosUsuario.length;
            const maiorPontuacao = Math.max(...data.maiorPontuacao.map(item => item.maior_pontuacao));
            const totalQuizzes = data.acertosUsuario.length;

            // Atualiza os KPIs na interface
            document.getElementById('media-acertos').textContent = mediaAcertos.toFixed(2);
            document.getElementById('maior-pontuacao').textContent = maiorPontuacao;
            document.getElementById('total-quizzes').textContent = totalQuizzes;

            // Configura e cria o gráfico de linha (Acertos por usuário)
            new Chart(document.getElementById('graficoAcertos'), {
                type: 'line',
                data: {
                    labels: data.acertosUsuario.map(item => item.nome),
                    datasets: [{
                        label: 'Acertos',
                        data: data.acertosUsuario.map(item => item.total_acertos),
                        borderColor: 'blue',
                        fill: false,
                        tension: 0.3,
                    }],
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: { position: 'top' },
                    },
                    scales: {
                        x: {
                            title: { display: true, text: 'Usuários' },
                        },
                        y: {
                            title: { display: true, text: 'Acertos' },
                        },
                    },
                }
            });

            // Configura e cria o gráfico de barras (Maior pontuação por quiz)
            new Chart(document.getElementById('graficoPontuacao'), {
                type: 'bar',
                data: {
                    labels: data.maiorPontuacao.map(item => item.titulo),
                    datasets: [{
                        label: 'Maior Pontuação',
                        data: data.maiorPontuacao.map(item => item.maior_pontuacao),
                        backgroundColor: 'orange',
                    }],
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: { position: 'top' },
                    },
                    scales: {
                        x: {
                            title: { display: true, text: 'Quizzes' },
                        },
                        y: {
                            title: { display: true, text: 'Pontuação' },
                        },
                    },
                }
            });
        })
        .catch(err => console.error('Erro ao carregar dados da dashboard:', err));
</script>
